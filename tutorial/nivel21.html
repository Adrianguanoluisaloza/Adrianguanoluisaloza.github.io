<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>✅ Nivel 21 - Validación de Formularios</title>
    <link rel="stylesheet" href="css/codequest.css">
    <script src="js/codequest.js" defer></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    </head>
<body data-nivel="21">
    <header class="header">
        <div class="nav-header">
            <a href="inicio.html" class="nav-btn">🏠 Menú</a>
            <span class="nivel-badge">⭐ NIVEL 21</span>
            <a href="nivel20.html" class="nav-btn">⬅️ Anterior</a>
        </div>
        <h1>✅ Validación de Formularios</h1>
    </header>
    
    <main class="container">
        <!-- Introducción -->
        <section class="seccion">
            <h2>🤔 ¿Por qué Validar?</h2>
            
            <div class="concepto-box">
                <h3>Validación = Verificar antes de enviar</h3>
                <p>La <strong>validación</strong> asegura que los datos que el usuario ingresa sean <strong>correctos y seguros</strong> antes de enviarlos al servidor.</p>
            </div>
            
            <p>Sin validación, podrían pasar cosas como:</p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>❌ Email sin @: "pedrogmail.com"</li>
                <li>❌ Contraseña muy corta: "123"</li>
                <li>❌ Edad negativa: "-5 años"</li>
                <li>❌ Campos vacíos obligatorios</li>
            </ul>
        </section>
        
        <!-- Tipos de validación -->
        <section class="seccion">
            <h2>🔍 Tipos de Validación</h2>
            
            <table class="tabla-validaciones">
                <tr>
                    <th>Tipo</th>
                    <th>¿Qué verifica?</th>
                    <th>Ejemplo</th>
                </tr>
                <tr>
                    <td><strong>Requerido</strong></td>
                    <td>Campo no vacío</td>
                    <td>Nombre obligatorio</td>
                </tr>
                <tr>
                    <td><strong>Longitud</strong></td>
                    <td>Mínimo/máximo caracteres</td>
                    <td>Contraseña mín. 8 caracteres</td>
                </tr>
                <tr>
                    <td><strong>Formato</strong></td>
                    <td>Patrón específico</td>
                    <td>Email válido con @</td>
                </tr>
                <tr>
                    <td><strong>Rango</strong></td>
                    <td>Valor entre límites</td>
                    <td>Edad entre 1 y 120</td>
                </tr>
                <tr>
                    <td><strong>Coincidencia</strong></td>
                    <td>Dos campos iguales</td>
                    <td>Confirmar contraseña</td>
                </tr>
            </table>
        </section>
        
        <!-- Validación HTML5 -->
        <section class="seccion">
            <h2>🏷️ Validación con HTML5</h2>
            
            <p>HTML5 tiene atributos de validación integrados:</p>
            
            <div class="codigo-ejemplo">
<pre><span class="comment">&lt;!-- Campo requerido --&gt;</span>
&lt;input type="text" <span class="keyword">required</span>&gt;

<span class="comment">&lt;!-- Longitud mínima y máxima --&gt;</span>
&lt;input type="text" <span class="keyword">minlength="3" maxlength="20"</span>&gt;

<span class="comment">&lt;!-- Email válido --&gt;</span>
&lt;input type="<span class="keyword">email</span>" required&gt;

<span class="comment">&lt;!-- Número en rango --&gt;</span>
&lt;input type="number" <span class="keyword">min="1" max="100"</span>&gt;

<span class="comment">&lt;!-- Patrón personalizado (solo letras) --&gt;</span>
&lt;input type="text" <span class="keyword">pattern="[A-Za-z]+"</span>&gt;</pre>
            </div>
            
            <div class="tip-box">
                La validación HTML5 es rápida pero <strong>siempre</strong> valida también con JavaScript para mayor control y mejores mensajes de error.
            </div>
        </section>
        
        <!-- Validación JavaScript -->
        <section class="seccion">
            <h2>⚡ Validación con JavaScript</h2>
            
            <div class="codigo-ejemplo">
<pre><span class="keyword">function</span> <span class="function">validarEmail</span>(email) {
    <span class="comment">// Expresión regular para email</span>
    <span class="keyword">const</span> regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    <span class="keyword">return</span> regex.<span class="function">test</span>(email);
}

<span class="keyword">function</span> <span class="function">validarFormulario</span>() {
    <span class="keyword">const</span> email = document.<span class="function">getElementById</span>(<span class="string">'email'</span>).value;
    
    <span class="keyword">if</span> (!email) {
        <span class="function">mostrarError</span>(<span class="string">'El email es requerido'</span>);
        <span class="keyword">return false</span>;
    }
    
    <span class="keyword">if</span> (!<span class="function">validarEmail</span>(email)) {
        <span class="function">mostrarError</span>(<span class="string">'Email inválido'</span>);
        <span class="keyword">return false</span>;
    }
    
    <span class="keyword">return true</span>;
}</pre>
            </div>
        </section>
        
        <!-- Demo interactivo -->
        <section class="seccion">
            <h2>🎮 ¡Prueba la Validación en Vivo!</h2>
            
            <div class="form-demo">
                <form id="formDemo" onsubmit="return enviarFormulario(event)">
                    <div class="form-grupo">
                        <label for="nombre">👤 Nombre Completo</label>
                        <input type="text" id="nombre" placeholder="Ej: María García" oninput="validarNombre()">
                        <div class="mensaje-error" id="errorNombre">El nombre debe tener al menos 3 caracteres</div>
                        <div class="mensaje-exito" id="exitoNombre">✓ Nombre válido</div>
                    </div>
                    
                    <div class="form-grupo">
                        <label for="email">📧 Email</label>
                        <input type="text" id="email" placeholder="Ej: maria@email.com" oninput="validarEmailCampo()">
                        <div class="mensaje-error" id="errorEmail">Ingresa un email válido (ejemplo@dominio.com)</div>
                        <div class="mensaje-exito" id="exitoEmail">✓ Email válido</div>
                    </div>
                    
                    <div class="form-grupo">
                        <label for="edad">🎂 Edad</label>
                        <input type="number" id="edad" placeholder="Ej: 12" oninput="validarEdad()">
                        <div class="mensaje-error" id="errorEdad">La edad debe estar entre 5 y 120 años</div>
                        <div class="mensaje-exito" id="exitoEdad">✓ Edad válida</div>
                    </div>
                    
                    <div class="form-grupo">
                        <label for="password">🔐 Contraseña</label>
                        <input type="password" id="password" placeholder="Mínimo 8 caracteres" oninput="validarPassword()">
                        <div class="indicador-fuerza" id="fuerzaPassword">
                            <div class="barra-fuerza" id="barra1"></div>
                            <div class="barra-fuerza" id="barra2"></div>
                            <div class="barra-fuerza" id="barra3"></div>
                            <div class="barra-fuerza" id="barra4"></div>
                        </div>
                        <div class="mensaje-error" id="errorPassword">La contraseña debe tener mínimo 8 caracteres</div>
                        <div class="mensaje-exito" id="exitoPassword">✓ Contraseña segura</div>
                    </div>
                    
                    <div class="form-grupo">
                        <label for="confirmar">🔐 Confirmar Contraseña</label>
                        <input type="password" id="confirmar" placeholder="Repite la contraseña" oninput="validarConfirmar()">
                        <div class="mensaje-error" id="errorConfirmar">Las contraseñas no coinciden</div>
                        <div class="mensaje-exito" id="exitoConfirmar">✓ Las contraseñas coinciden</div>
                    </div>
                    
                    <button type="submit" class="btn-submit" id="btnEnviar">
                        📤 Enviar Registro
                    </button>
                </form>
                
                <div id="mensajeExito" style="display: none; text-align: center; padding: 20px; background: rgba(16,185,129,0.2); border-radius: 15px; margin-top: 20px;">
                    <h3 style="color: var(--exito);">🎉 ¡Registro Exitoso!</h3>
                    <p>Todos los campos fueron validados correctamente</p>
                </div>
            </div>
        </section>
        
        <!-- Quiz -->
        <section class="seccion">
            <h2>🎯 Quiz - ¡Demuestra lo que Aprendiste!</h2>
            
            <div class="progreso-bar">
                <div class="progreso-fill" id="progresoQuiz" style="width: 0%"></div>
            </div>
            
            <div class="quiz-container">
                <div class="quiz-pregunta">
                    <h4>1. ¿Qué atributo HTML hace un campo obligatorio?</h4>
                    <div class="quiz-opciones">
                        <div class="quiz-opcion" onclick="verificarRespuesta(this, false)">mandatory</div>
                        <div class="quiz-opcion" onclick="verificarRespuesta(this, true)">required</div>
                        <div class="quiz-opcion" onclick="verificarRespuesta(this, false)">obligatory</div>
                    </div>
                </div>
                
                <div class="quiz-pregunta">
                    <h4>2. ¿Qué tipo de input valida automáticamente el formato de email?</h4>
                    <div class="quiz-opciones">
                        <div class="quiz-opcion" onclick="verificarRespuesta(this, false)">type="text"</div>
                        <div class="quiz-opcion" onclick="verificarRespuesta(this, true)">type="email"</div>
                        <div class="quiz-opcion" onclick="verificarRespuesta(this, false)">type="mail"</div>
                    </div>
                </div>
                
                <div class="quiz-pregunta">
                    <h4>3. ¿Para qué sirve el atributo "pattern"?</h4>
                    <div class="quiz-opciones">
                        <div class="quiz-opcion" onclick="verificarRespuesta(this, false)">Dar estilo al campo</div>
                        <div class="quiz-opcion" onclick="verificarRespuesta(this, false)">Mostrar un placeholder</div>
                        <div class="quiz-opcion" onclick="verificarRespuesta(this, true)">Definir una expresión regular para validar</div>
                    </div>
                </div>
                
                <div class="quiz-pregunta">
                    <h4>4. ¿Cuándo se debe validar con JavaScript además de HTML?</h4>
                    <div class="quiz-opciones">
                        <div class="quiz-opcion" onclick="verificarRespuesta(this, false)">Nunca, HTML5 es suficiente</div>
                        <div class="quiz-opcion" onclick="verificarRespuesta(this, true)">Siempre, para mayor control y mensajes personalizados</div>
                        <div class="quiz-opcion" onclick="verificarRespuesta(this, false)">Solo en formularios de pago</div>
                    </div>
                </div>
            </div>
            
            <div class="estrellas">
                <span class="estrella" id="star1">⭐</span>
                <span class="estrella" id="star2">⭐</span>
                <span class="estrella" id="star3">⭐</span>
            </div>
        </section>
        
        <!-- Navegación -->
        <nav class="nav-final">
            <a href="nivel20.html">⬅️ Nivel 20</a>
            <a href="nivel22.html">Nivel 22 ➡️</a>
        </nav>
    </main>
    
    <script>
        // Validaciones del formulario demo
        function validarNombre() {
            const nombre = document.getElementById('nombre');
            const error = document.getElementById('errorNombre');
            const exito = document.getElementById('exitoNombre');
            
            if (nombre.value.length >= 3) {
                nombre.classList.remove('invalido');
                nombre.classList.add('valido');
                error.classList.remove('visible');
                exito.classList.add('visible');
                return true;
            } else if (nombre.value.length > 0) {
                nombre.classList.remove('valido');
                nombre.classList.add('invalido');
                error.classList.add('visible');
                exito.classList.remove('visible');
                return false;
            } else {
                nombre.classList.remove('valido', 'invalido');
                error.classList.remove('visible');
                exito.classList.remove('visible');
                return false;
            }
        }
        
        function validarEmailCampo() {
            const email = document.getElementById('email');
            const error = document.getElementById('errorEmail');
            const exito = document.getElementById('exitoEmail');
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (regex.test(email.value)) {
                email.classList.remove('invalido');
                email.classList.add('valido');
                error.classList.remove('visible');
                exito.classList.add('visible');
                return true;
            } else if (email.value.length > 0) {
                email.classList.remove('valido');
                email.classList.add('invalido');
                error.classList.add('visible');
                exito.classList.remove('visible');
                return false;
            } else {
                email.classList.remove('valido', 'invalido');
                error.classList.remove('visible');
                exito.classList.remove('visible');
                return false;
            }
        }
        
        function validarEdad() {
            const edad = document.getElementById('edad');
            const error = document.getElementById('errorEdad');
            const exito = document.getElementById('exitoEdad');
            const valor = parseInt(edad.value);
            
            if (valor >= 5 && valor <= 120) {
                edad.classList.remove('invalido');
                edad.classList.add('valido');
                error.classList.remove('visible');
                exito.classList.add('visible');
                return true;
            } else if (edad.value.length > 0) {
                edad.classList.remove('valido');
                edad.classList.add('invalido');
                error.classList.add('visible');
                exito.classList.remove('visible');
                return false;
            } else {
                edad.classList.remove('valido', 'invalido');
                error.classList.remove('visible');
                exito.classList.remove('visible');
                return false;
            }
        }
        
        function validarPassword() {
            const password = document.getElementById('password');
            const error = document.getElementById('errorPassword');
            const exito = document.getElementById('exitoPassword');
            const valor = password.value;
            
            // Calcular fuerza
            let fuerza = 0;
            if (valor.length >= 8) fuerza++;
            if (/[A-Z]/.test(valor)) fuerza++;
            if (/[0-9]/.test(valor)) fuerza++;
            if (/[^A-Za-z0-9]/.test(valor)) fuerza++;
            
            // Mostrar barras
            const barras = document.querySelectorAll('.barra-fuerza');
            barras.forEach((barra, i) => {
                barra.classList.remove('debil', 'media', 'fuerte');
                if (i < fuerza) {
                    if (fuerza <= 1) barra.classList.add('debil');
                    else if (fuerza <= 2) barra.classList.add('media');
                    else barra.classList.add('fuerte');
                }
            });
            
            if (valor.length >= 8) {
                password.classList.remove('invalido');
                password.classList.add('valido');
                error.classList.remove('visible');
                exito.classList.add('visible');
                validarConfirmar();
                return true;
            } else if (valor.length > 0) {
                password.classList.remove('valido');
                password.classList.add('invalido');
                error.classList.add('visible');
                exito.classList.remove('visible');
                return false;
            } else {
                password.classList.remove('valido', 'invalido');
                error.classList.remove('visible');
                exito.classList.remove('visible');
                return false;
            }
        }
        
        function validarConfirmar() {
            const password = document.getElementById('password').value;
            const confirmar = document.getElementById('confirmar');
            const error = document.getElementById('errorConfirmar');
            const exito = document.getElementById('exitoConfirmar');
            
            if (confirmar.value === password && confirmar.value.length > 0) {
                confirmar.classList.remove('invalido');
                confirmar.classList.add('valido');
                error.classList.remove('visible');
                exito.classList.add('visible');
                return true;
            } else if (confirmar.value.length > 0) {
                confirmar.classList.remove('valido');
                confirmar.classList.add('invalido');
                error.classList.add('visible');
                exito.classList.remove('visible');
                return false;
            } else {
                confirmar.classList.remove('valido', 'invalido');
                error.classList.remove('visible');
                exito.classList.remove('visible');
                return false;
            }
        }
        
        function enviarFormulario(e) {
            e.preventDefault();
            
            const nombreValido = validarNombre();
            const emailValido = validarEmailCampo();
            const edadValida = validarEdad();
            const passwordValido = validarPassword();
            const confirmarValido = validarConfirmar();
            
            if (nombreValido && emailValido && edadValida && passwordValido && confirmarValido) {
                document.getElementById('formDemo').style.display = 'none';
                document.getElementById('mensajeExito').style.display = 'block';
                guardarProgreso();
            }
            
            return false;
        }
        
        // Quiz
        let correctas = 0;
        const totalPreguntas = 4;
        
        function verificarRespuesta(elemento, esCorrecta) {
            if (elemento.classList.contains('correcta') || elemento.classList.contains('incorrecta')) return;
            
            const opciones = elemento.parentElement.querySelectorAll('.quiz-opcion');
            opciones.forEach(op => op.style.pointerEvents = 'none');
            
            if (esCorrecta) {
                elemento.classList.add('correcta');
                correctas++;
                actualizarEstrellas();
            } else {
                elemento.classList.add('incorrecta');
            }
            
            const respondidas = document.querySelectorAll('.quiz-opcion.correcta, .quiz-opcion.incorrecta').length;
            document.getElementById('progresoQuiz').style.width = (respondidas / totalPreguntas * 100) + '%';
            
            if (respondidas === totalPreguntas) guardarProgreso();
        }
        
        function actualizarEstrellas() {
            const porcentaje = (correctas / totalPreguntas) * 100;
            if (porcentaje >= 25) document.getElementById('star1').classList.add('activa');
            if (porcentaje >= 50) document.getElementById('star2').classList.add('activa');
            if (porcentaje >= 75) document.getElementById('star3').classList.add('activa');
        }
        
        function guardarProgreso() {
            const niveles = JSON.parse(localStorage.getItem('nivelesCompletados') || '[]');
            if (!niveles.includes(21)) {
                niveles.push(21);
                localStorage.setItem('nivelesCompletados', JSON.stringify(niveles));
            }
        }
    </script>
</body>
</html>
